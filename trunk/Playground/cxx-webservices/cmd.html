<html>
<head>
    <style type="text/css">
        div {
            position: relative;
            width: 100%;
            height: 100%;
        }

        textarea {
            padding: 10px;
            border-spacing: 50px;
            width: 100%;
            height: 100%
        }

        div.inputTextArea {
            height: 60%;
        }

        div.outputTextArea {
            height: 30%;
        }


    </style>
    <script type="text/javascript">


        var app = {};


        app.alert = function (msg) {
            //alert(msg);
            console.log(msg);
        };

        app.input = document.getElementById("input");
        app.inputMargin = 10;


        app.send = function (title, payload) {
            app.alert('app.send');
            var httpRequest = new XMLHttpRequest();
            httpRequest.open("PUT", "http://localhost:4000/" + title, false);
            httpRequest.send(payload);

            httpRequest.onreadystatechange = function () {
                if (httpRequest.readyState == 4) {
                    if (httpRequest.status == 200) {
                        app.alert('HTTP STATUS 200');
                        app.alert(JSON.stringify(httpRequest));
                        app.onReply(httpRequest.responseText);
                    } else {
                        app.alert("HTTP STATUS " + httpRequest.status);
                    }
                } else {
                    app.alert("HTTP STATUS " + httpRequest.status);
                    app.alert("httpRequest.readyState: " + httpRequest.readyState);
                }
            };
        };

        window.onload = function () {
            app.alert("window.onload");
            app.inputTextArea = document.getElementById("inputTextArea");
            app.outputTextArea = document.getElementById("outputText");
            app.submitButton = document.getElementById("compileButton");
            app.inputTextArea.style = { left:50, right:50, width:200 };
            app.enterTimeoutLoop();
        };


        app.enterTimeoutLoop = function () {
            app.alert("app.enterTimeoutLoop");
            app.rebuildLayout();
            window.setTimeout(app.enterTimeoutLoop, 2000);
        };

        app.rebuildLayout = function () {
            app.alert("app.rebuildLayout");
            app.alert("window.innerHeight: " + window.innerHeight);
            app.inputTextArea.style.left = app.margin;
            app.inputTextArea.clientTop = app.margin;

            while (app.inputTextArea.row)


                while (app.inputTextArea.clientHeight + (2 * app.margin) < window.innerWidth) {
                    app.inputTextArea.cols += 1;
                }
            while (app.inputTextArea.clientWidth > (window.innerWidth + (2 * app.margin))) {
                app.inputTextArea.cols -= 1;
            }

            while (app.outputTextArea.clientHeight + (2 * app.margin) < window.innerHeight) {
                app.inputTextArea.rows += 1;
            }
            while (app.outputTextArea.clientHeight > (window.innerHeight + (2 * app.margin))) {
                app.inputTextArea.rows -= 1;
            }

            while (app.inputTextArea.clientHeight + 2 * app.margin < window.innerHeight) {
                app.inputTextArea.rows += 1;
            }
            app.inputTextArea.clientWidth = 80 * window.innerWidth / 100;
            app.alert("end app.rebuildLayout");


        };


        app.onCompile = function () {
            app.alert('app.onCompile');
            var compileButton = document.getElementById('TextArea');
            alert("compile: " + compileButton.textContent);
            app.send("compile", compileButton.textContent);
        };

        app.onReply = function (reply) {
            app.alert(reply);
            app.alert(JSON.parse(reply));
            var obj = JSON.parse(reply);
        };


    </script>
</head>
<body>
<div class="root">
    <div class="inputTextArea">
        <label for="inputTextArea"><textarea id="inputTextArea">Hello! </textarea></label>
    </div>
    <div class="outputTextArea"><label for="outputTextArea"></label><textarea id="outputTextArea">You fool!</textarea>
    </div>
    <div class="submitButton">
        <button id="submitButton">Compile!</button>
    </div>
</div>
</body>
</html>
